/* DesignPlayground.css */

@import './DesignPlaygroundToggles.css';
@import './playground/PlaygroundHeader.css';
@import './playground/DesignSelector.css';
@import './playground/Preview.css';
@import './playground/Controls.css';

:root {
  --active-color: #03a9f4;
}

.playground-container {
  display: flex;
  flex-direction: column;
  height: calc(100vh - 64px); /* Adjust based on header height */
  width: 100vw;
  background-color: #1e1e1e;
  color: white;
  overflow: hidden;
  position: fixed; /* Ensure it takes up window space */
  top: 64px; /* Start below main nav */
  left: 0;
}

.playground-content {
  display: flex;
  flex: 1;
  overflow: hidden;
  height: calc(100% - 100px); /* Full height minus header */
}

/* Left Sidebar */
.design-selector {
  width: 250px;
  background-color: #252525;
  border-right: 1px solid #333;
  padding: 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
  overflow-y: auto;
}

.design-selector h3 {
  margin: 0 0 1rem 0;
  font-size: 1rem;
  color: #aaa;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.design-option {
  position: relative;
  padding: 1rem;
  background-color: #333;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  border: 1px solid transparent;
}

.design-option:hover {
  background-color: #3d3d3d;
}

.design-option.active {
  background-color: #444;
  border-color: var(--active-color);
}

.design-name {
  font-weight: 600;
  margin-bottom: 0.25rem;
  line-height: 1.3;
}

.design-icon-wrapper {
  position: absolute;
  bottom: 0.75rem;
  right: 0.75rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

.design-icon {
  opacity: 0.6;
  color: #888;
  transition: all 0.2s ease;
}

.design-option.active .design-icon {
  color: var(--active-color);
  opacity: 1;
}

.design-option:hover .design-icon {
  opacity: 0.8;
}

.design-dims {
  font-size: 0.8rem;
  color: #888;
  line-height: 1.3;
}

/* Design Tree Structure */
.design-tree {
  display: flex;
  flex-direction: column;
  gap: 0;
  position: relative;
}

.design-option.parent {
  position: relative;
  margin-bottom: 0.75rem;
  transition: all 0.3s ease;
  overflow: visible; /* Allow toggles to be visible */
}

.design-card-content {
  position: relative;
  z-index: 1;
}

/* Inheritance toggles container - inside card flow */
.inheritance-toggles {
  margin-top: 0.75rem;
  padding: 0.75rem;
  background-color: #1a1a1a;
  border: 1px solid #444;
  border-radius: 6px;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  z-index: 2;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  position: relative; /* Keep in flow but allow proper stacking */
}

.inheritance-toggle-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 0.5rem;
}

.inheritance-toggle-item label {
  font-size: 0.85rem;
  color: #ccc;
  font-weight: 500;
}

/* Ensure consistent width for sub-design cards, but allow natural height */
.design-option.sub {
  position: relative;
  margin-left: 2rem; /* Shift cards to the right */
  width: calc(100% - 2rem); /* Ensure consistent width */
}

/* Tree connector: vertical line down from parent, then horizontal line */
.tree-connector {
  position: relative;
  height: 20px;
  margin-left: 1rem;
  margin-bottom: 0;
}

.tree-line-vertical {
  position: absolute;
  left: 0;
  top: 0;
  width: 2px;
  height: 20px;
  background-color: #555;
}

.tree-line-horizontal {
  position: absolute;
  left: 0;
  top: 18px;
  width: 1rem;
  height: 2px;
  background-color: #555;
}

/* Container for all sub-designs */
.sub-designs-container {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  margin-left: 1rem;
  position: relative;
  padding-top: 0;
}

/* Main vertical stem: continuous line from horizontal connector down through all sub-designs */
.sub-designs-container::before {
  content: '';
  position: absolute;
  left: 1rem; /* Align with end of horizontal connector */
  top: -2px; /* Start from horizontal connector */
  width: 2px;
  height: 100%; /* Extend full height, will be capped by last item */
  background-color: #555;
  z-index: 0;
}

.sub-design-wrapper {
  position: relative;
  display: flex;
  align-items: center;
}

/* Horizontal branch from main stem to each sub-design */
.sub-design-wrapper::before {
  content: '';
  position: absolute;
  left: 1rem; /* Start at main stem position (main stem is at 1rem from container) */
  top: 50%;
  transform: translateY(-50%);
  width: 1rem; /* Extend to card left edge (card margin-left: 2rem from wrapper, but branch starts at 1rem, so needs 1rem more) */
  height: 2px;
  background-color: #555;
  z-index: 1;
}

/* Cap the vertical stem at the center of the last sub-design */
.sub-design-wrapper:last-child::after {
  content: '';
  position: absolute;
  left: 1rem; /* Align with main stem */
  top: 50%; /* Start at center of card (where horizontal branch connects) */
  width: 2px;
  height: calc(50% + 0.375rem); /* Cover from center to bottom plus half gap */
  background-color: #252525; /* Match container background to hide the line */
  z-index: 2;
}

/* .design-option.parent::after {
  content: 'üìê';
  position: absolute;
  right: 0.75rem;
  top: 0.75rem;
  font-size: 0.9rem;
  opacity: 0.5;
  pointer-events: none;
} */

/* Center Preview */
.preview-area {
  flex: 1;
  background-color: #1e1e1e;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 2rem;
  overflow: hidden; /* Prevent scroll here, we scale content */
  position: relative;
}

/* Preview Tab Switcher */
.preview-tabs {
  display: inline-flex;
  position: absolute;
  top: 1rem;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
  background-color: #252525;
  border: 1px solid #444;
  border-radius: 6px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.preview-tab {
  padding: 0.6rem 1.2rem;
  background-color: #333;
  border: none;
  border-right: 1px solid #444;
  color: #aaa;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 0.85rem;
  font-weight: 500;
  position: relative;
}

.preview-tab:last-child {
  border-right: none;
}

.preview-tab:hover:not(.active) {
  background-color: #3d3d3d;
  color: #fff;
}

.preview-tab.active {
  background-color: var(--active-color);
  color: #fff;
  z-index: 1;
}

/* Textual Preview */
.textual-preview {
  flex: 1;
  width: 100%;
  overflow-y: auto;
  padding: 1rem;
  margin-top: 3.5rem; /* Space for tabs at top */
}

/* URL Preview Card */
.url-preview-card {
  background-color: #252525;
  border: 1px solid #444;
  border-radius: 6px;
  padding: 1rem;
  margin-bottom: 1.5rem;
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace;
}

.url-preview-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.75rem;
}

.url-preview-label {
  font-size: 0.75rem;
  color: #888;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  font-weight: 600;
}

.url-open-button {
  background-color: #333;
  border: 1px solid #555;
  border-radius: 4px;
  padding: 0.4rem 0.6rem;
  color: #aaa;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.url-open-button:hover {
  background-color: var(--active-color);
  border-color: var(--active-color);
  color: #fff;
}

.url-preview-content {
  font-size: 0;
  line-height: 1.6;
  word-break: break-all;
  color: #ccc;
  letter-spacing: 0;
  overflow-wrap: break-word;
}

.url-preview-content .url-segment {
  font-size: 0.7rem;
  display: inline;
}

.url-segment {
  transition: all 0.3s ease;
  border-radius: 3px;
  display: inline;
}

.url-segment-base {
  color: #4a9eff;
}

.url-segment-variable {
  color: #ff6b9d;
  background-color: rgba(255, 107, 157, 0.1);
}

.url-segment-canvas {
  color: #51cf66;
  background-color: rgba(81, 207, 102, 0.1);
}

.url-segment-layer-logo {
  color: #9C27B0;
  background-color: rgba(156, 39, 176, 0.1);
}

.url-segment-layer-title {
  color: #ffd43b;
  background-color: rgba(255, 212, 59, 0.1);
}

.url-segment-layer-tagline {
  color: #74c0fc;
  background-color: rgba(116, 192, 252, 0.1);
}

.url-segment-layer-image {
  color: #ff922b;
  background-color: rgba(255, 146, 43, 0.1);
}

.url-segment-layer-origPrice {
  color: #c2255c;
  background-color: rgba(194, 37, 92, 0.1);
}

.url-segment-layer-price {
  color: #20c997;
  background-color: rgba(32, 201, 151, 0.1);
}

.url-segment-layer-apply {
  color: #9775fa;
  background-color: rgba(151, 117, 250, 0.1);
}

.url-segment-publicId {
  color: #868e96;
}

.url-segment-separator {
  color: #666;
}

.url-segment.highlighted {
  background-color: var(--active-color) !important;
  color: #fff !important;
  box-shadow: 0 0 8px rgba(3, 169, 244, 0.5);
  transform: scale(1.05);
}

.rules-table {
  width: 100%;
  border-collapse: collapse;
  background-color: #252525;
  border-radius: 4px;
  overflow: hidden;
  table-layout: fixed;
}

.rules-table thead {
  background-color: #333;
}

.rules-table th {
  padding: 0.75rem;
  text-align: left;
  font-weight: 600;
  color: #fff;
  border-bottom: 2px solid #444;
  font-size: 0.85rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.rules-table th:first-child {
  width: 40%;
}

.rules-table th:last-child {
  width: 60%;
}

.rules-table td {
  padding: 0.75rem;
  border-bottom: 1px solid #333;
  color: #ccc;
  font-size: 0.9rem;
}

.rules-table tbody tr:hover {
  background-color: #2a2a2a;
}

.rules-table .category-row {
  background-color: #2a2a2a;
}

.rules-table .category-row td {
  padding: 1rem 0.75rem;
  color: var(--active-color);
  font-size: 0.95rem;
  border-bottom: 2px solid #444;
}

.rules-table .sub-category-row {
  background-color: #2f2f2f;
}

.rules-table .sub-category-row td {
  padding: 0.75rem 0.75rem 0.5rem 1.5rem;
  color: #aaa;
  font-size: 0.9rem;
  border-bottom: 1px solid #3a3a3a;
  font-weight: 600;
}

/* Row highlighting animation */
.rules-table tbody tr[data-row-key] {
  transition: all 0.4s ease;
}

.rules-table tbody tr[data-row-key].highlighted {
  background-color: rgba(3, 169, 244, 0.2) !important;
  box-shadow: 0 0 12px rgba(3, 169, 244, 0.4);
  transform: scale(1.01);
}

.rules-table tbody tr[data-row-key].highlighted td {
  color: #fff;
  font-weight: 600;
}

/* Editable Rule Inputs */
.rule-input {
  width: 100%;
  padding: 0.4rem 0.5rem;
  background-color: #2a2a2a;
  border: 1px solid #444;
  border-radius: 4px;
  color: #fff;
  font-size: 0.85rem;
  font-family: inherit;
  transition: all 0.2s ease;
}

.rule-input:focus {
  outline: none;
  border-color: var(--active-color);
  background-color: #333;
  box-shadow: 0 0 0 2px rgba(3, 169, 244, 0.2);
}

.rule-input:hover:not(:disabled):not([readonly]) {
  border-color: #555;
  background-color: #2f2f2f;
}

.rule-input:disabled,
.rule-input[readonly] {
  opacity: 0.5;
  cursor: not-allowed;
  background-color: #1f1f1f;
}

.rule-input-color {
  height: 32px;
  padding: 2px;
  cursor: pointer;
}

.rule-input-color:disabled {
  cursor: not-allowed;
}

.rule-input-number {
  width: 100px;
}

.rule-input-select {
  cursor: pointer;
}

.rule-input-text {
  min-width: 150px;
}

.preview-wrapper {
  flex: 1;
  box-shadow: 0 20px 50px rgba(0,0,0,0.5);
  transition: all 0.3s ease;
  position: relative;
  /* Max dimensions to ensure it fits in viewport without scroll */
  max-width: 100%;
  max-height: 100%;
  display: flex;
  width: 100%;
  margin-top: 3.5rem; /* Space for tabs at top */
}

.preview-image {
  display: block;
  border-radius: 4px;
  width: 100%;
  height: 100%;
  object-fit: contain;
}

/* Double image technique for smooth transition */
.preview-image.previous {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 1;
}

.preview-image.current {
  position: relative;
  z-index: 2;
  opacity: 1;
  transition: opacity 0.3s ease;
}

/* When loading, keep current image visible but show spinner on top */
.preview-image.current.loading {
  /* We can keep it visible or hide it if we want to show Previous underneath.
     Since we have Previous underneath, we can fade out Current if it's 'loading' 
     BUT 'current' is the NEW URL. So if it's loading, it's not ready.
     So 'current' should be hidden until loaded. 
  */
  opacity: 0; 
}

.loading-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
  background: rgba(0,0,0,0.2); /* Slight dim */
  border-radius: 4px;
}

.spinner {
  width: 40px;
  height: 40px;
  border: 4px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: var(--active-color);
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Right Controls */
.controls-panel {
  width: 300px;
  background-color: #252525;
  border-left: 1px solid #333;
  padding: 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  overflow-y: auto;
}

.controls-panel h3 {
  margin: 0;
  font-size: 1rem;
  color: #aaa;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.control-group {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  margin-bottom: 1rem;
}

.control-group:last-child {
  margin-bottom: 0;
}

.control-group label {
  font-size: 0.9rem;
  font-weight: 500;
}

.control-group input,
.control-group select {
  background-color: #333;
  border: 1px solid #444;
  border-radius: 6px;
  padding: 0.75rem;
  color: white;
  font-size: 1rem;
  transition: border-color 0.2s;
  width: 100%;
  font-family: 'Inter', sans-serif;
}

.control-group input:focus,
.control-group select:focus {
  outline: none;
  border-color: var(--active-color);
}

.control-group select {
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ccc' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 0.75rem center;
  background-size: 16px;
  padding-right: 2.5rem;
  cursor: pointer;
}

.control-section {
  margin-bottom: 1.5rem;
}

.control-section:last-of-type {
  margin-bottom: 0;
}

.control-subsection {
  margin-bottom: 1rem;
  padding-left: 0.5rem;
  border-left: 2px solid #444;
}

.control-subsection:last-child {
  margin-bottom: 0;
}

.subsection-title {
  font-size: 0.85rem;
  font-weight: 600;
  color: #aaa;
  margin-bottom: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.section-title {
  font-size: 0.85rem;
  font-weight: 600;
  color: #888;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 0.75rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid #333;
}

.generated-url {
  margin-top: auto;
  padding-top: 1rem;
  border-top: 1px solid #333;
}

.url-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.5rem;
}

.url-header label {
  font-size: 0.8rem;
  color: #888;
}

.copy-btn {
  background: transparent;
  border: 1px solid #444;
  color: #aaa;
  font-size: 0.7rem;
  padding: 2px 8px;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s;
}

.copy-btn:hover {
  border-color: var(--active-color);
  color: var(--active-color);
}

.url-display {
  border: 1px solid #444;
  border-radius: 4px;
  padding: 0.75rem;
  background-color: #1a1a1a;
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace;
  font-size: 0.75rem;
  color: #ccc;
  line-height: 1.5;
  max-height: 200px;
  overflow-y: auto;
  overflow-x: auto;
  word-break: break-all;
  white-space: pre-wrap;
}

.url-display::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

.url-display::-webkit-scrollbar-track {
  background: #1a1a1a;
  border-radius: 4px;
}

.url-display::-webkit-scrollbar-thumb {
  background: #444;
  border-radius: 4px;
}

.url-display::-webkit-scrollbar-thumb:hover {
  background: #555;
}

.broken-image-placeholder {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background-color: #2a2a2a;
  border: 2px dashed #555;
  border-radius: 4px;
  color: #888;
  z-index: 5;
}

.broken-icon {
  font-size: 3rem;
  margin-bottom: 0.5rem;
  opacity: 0.6;
}

.broken-text {
  font-size: 0.9rem;
  text-align: center;
  color: #999;
}

/* Layer Overlay Toggle Button */
.layer-overlay-toggle {
  position: absolute;
  bottom: 1rem;
  left: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0.75rem;
  background-color: rgba(37, 37, 37, 0.9);
  border: 1px solid #444;
  border-radius: 6px;
  color: #aaa;
  cursor: pointer;
  transition: all 0.2s ease;
  z-index: 1001;
  font-size: 0.85rem;
  font-weight: 500;
  backdrop-filter: blur(4px);
}

.layer-overlay-toggle:hover {
  background-color: rgba(45, 45, 45, 0.95);
  border-color: #555;
  color: #fff;
}

.layer-overlay-toggle.active {
  background-color: rgba(3, 169, 244, 0.2);
  border-color: var(--active-color);
  color: var(--active-color);
}

.layer-overlay-toggle svg {
  flex-shrink: 0;
}

.layer-overlay-toggle span {
  white-space: nowrap;
}

/* Layer Overlay Rectangles */
.layer-overlay {
  position: absolute;
  border: 1px solid rgba(3, 169, 244, 0.8);
  background-color: rgba(3, 169, 244, 0.1);
  pointer-events: none;
  z-index: 1000;
  box-sizing: border-box;
  transition: all 0.2s ease;
}

.layer-overlay:hover {
  border-color: rgba(3, 169, 244, 1);
  background-color: rgba(3, 169, 244, 0.15);
}
